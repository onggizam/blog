# 쿠버네티스에서 데이터 지역성 보장하기

_by Seunggi Hong_

**_이 글은 제가 직접 작성하여 한국콘텐츠학회 종합학술대회에 제출한 논문을 기반으로 작성되었습니다._**

## 들어가며

대용량 데이터 처리와 머신러닝, 딥러닝 워크로드는 점점 더 많은 기업과 연구 기관에서 핵심 인프라로 자리 잡고 있습니다. 이러한 워크로드는 단순히 저장 공간만 필요한 것이 아니라, 빠른 데이터 접근성과 효율적인 자원 관리가 뒷받침되어야 합니다.

최근에는 컨테이너 오케스트레이션 도구인 쿠버네티스(Kubernetes) 가 클라우드 네이티브 환경의 표준으로 자리잡으면서, 빅데이터 처리 플랫폼 또한 쿠버네티스 환경에서 운영되는 경우가 많아졌습니다. 문제는, 쿠버네티스 클러스터 내부에서 실행되는 Spark가 외부 HDFS에 접근할 때 데이터 지역성(Locality) 을 보장하지 못한다는 점입니다.

이 글에서는 이 문제를 해결하기 위해 Alluxio를 활용한 Spark–HDFS 통합 아키텍처를 소개하고, 실험을 통해 얻은 성능 결과와 시사점을 공유하고자 합니다.

## 왜 데이터 지역성이 중요한가?

데이터 지역성이란 계산을 수행하는 노드와 데이터를 보관하는 노드가 물리적으로 가까운 상태를 의미합니다.

- 노드 간 네트워크 전송은 큰 비용과 시간을 소모합니다.
- 반면 데이터가 같은 노드에 존재한다면, Spark Executor는 데이터를 빠르게 접근할 수 있어 전체 처리 시간이 단축됩니다.

즉, 데이터 지역성을 보장하지 못하면 클러스터가 아무리 크더라도 네트워크 병목이 발생해 성능이 떨어지게 됩니다.

## 제안하는 아키텍처

이번 연구에서는 쿠버네티스 클러스터 내부에 Alluxio를 배포하고, 외부 HDFS를 Alluxio에 마운트하여 Spark가 Alluxio를 통해 데이터를 읽도록 설계했습니다.
• Spark & Alluxio: Pod 형태로 쿠버네티스 클러스터에 배포
• Alluxio 역할: 외부 HDFS 데이터를 In-Memory 캐시 형태로 제공
• 효과: Spark Executor는 동일 노드에 배포된 Alluxio 클라이언트를 통해 데이터 지역성을 유지하며 처리

<p align="center">
  <img src="../../assets/data-locality-1.png" alt="alluxio" width="300"/>
</p>

위 아키텍쳐 다이어그램에서는 Spark와 Alluxio가 K8s 클러스터 내부에서 긴밀하게 통합된 모습을 보여주며, 외부 HDFS는 Alluxio에 마운트되어 데이터 접근 경로를 단축합니다.

## 동작 프로세스

실행 과정은 다음과 같습니다. 1. 사용자가 Spark Job을 제출하면, Alluxio 클라이언트가 함께 배포됩니다. 2. Alluxio Master는 데이터가 존재하는 노드를 알려줍니다. 3. Spark Executor는 해당 데이터가 있는 노드에서 실행되며, Alluxio를 통해 지역성을 보장한 상태로 데이터를 가져옵니다.

<p align="center">
  <img src="../../assets/data-locality-2.png" alt="alluxio" width="600"/>
</p>

위 플로우 차트를 보면 Spark Executor와 Alluxio 클라이언트가 같은 Pod 내에서 동작하는 방식으로 데이터 이동 비용을 최소화하는 구조를 확인할 수 있습니다.

## 실험 환경 및 결과

실험은 4개의 노드로 구성된 클러스터에서 진행되었습니다.

- 소프트웨어: Kubernetes 1.28.6, Spark 3.4.0, Alluxio 2.9.3, HDFS 3.3.0
- 하드웨어: SSD 및 HDD 혼합 저장소, Intel Xeon 다중 코어 CPU, 총 메모리 약 558GB
- 데이터셋: 약 4GB 크기의 CSV 파일

## 결과 비교

- 제안한 방법 (K8s + Spark + Alluxio + HDFS): 평균 0.96초
- 기존 방법 (YARN + Spark + HDFS): 평균 0.78초

즉, 기존 YARN 기반 대비 실행 시간은 약간 늘었지만, 쿠버네티스 환경의 장점인 유연한 자원 할당을 확보하면서도 성능 저하가 크지 않음을 확인했습니다 ￼.

## 마무리

이 연구에서 제안한 구조는 쿠버네티스 기반 Spark 클러스터에서도 HDFS 데이터에 대한 지역성을 보장할 수 있는 방법을 제시합니다.

- Alluxio의 In-Memory 캐시와 네트워크 최적화를 통해 Spark Executor가 데이터에 빠르게 접근
- 외부 HDFS를 쿠버네티스 내부 워크로드와 통합하여 빅데이터 워크로드에 최적화된 아키텍처 제공
- 향후 데이터 크기를 확장하고 다양한 연산을 적용해 추가적인 성능 평가 예정

컨테이너 기반 빅데이터 환경을 고민하는 분들에게 이번 사례가 좋은 참고가 될 수 있을 것입니다.

# 오픈소스 기여 경험: TODO 주석을 채우자

_by Seunggi Hong_

쿠버네티스를 조금 더 편리하게 다루기 위한 다양한 도구들이 존재한다. 그중 GoogleCloudPlatform에서 관리하는 **kubectl-ai** 레포지토리는 LLM 모델을 이용해 kubectl 명령어를 보조하는 흥미로운 프로젝트다.

최근 나는 이 레포지토리에서 작은 TODO 주석 하나를 해결하면서도, 프로젝트의 신뢰성을 높이는 경험을 했다. 바로 모델 다운로드 로직에 무결성 검증을 추가한 것이다.

## 주석 하나에서 시작된 문제의식

원래 코드에는 Hugging Face에서 모델을 내려받는 로직이 있었지만, 다음과 같은 주석이 있었다.

```bash
# TODO Verify checksum
```

즉, 모델 파일을 단순히 다운로드만 하고, 그 파일이 올바른지 확인하는 과정이 전혀 없었던 것이다. 모델 파일은 수 GB 이상으로 크기도 크고, 다운로드 과정에서 손상되거나 중간자 공격과 같은 보안 위협이 발생할 수도 있다. 무결성 검증은 단순히 ‘좋으면 하는 것’이 아니라 반드시 필요한 절차였다.

## 개선 과정

나는 Hugging Face API를 살펴보다가 모델 파일의 SHA-256 체크섬 값을 API 응답에서 제공한다는 사실을 확인했다. 이를 활용하면 간단하게 무결성 검증을 자동화할 수 있다.

개선된 로직의 핵심은 다음과 같다.

### 1. 예상 체크섬 가져오기

Hugging Face API에서 해당 파일의 SHA-256 값을 조회한다.

```bash
EXPECTED_SHA256=$(curl -s "https://huggingface.co/api/models/${MODEL_REPO}" | \
 jq -r ".siblings[] | select(.rfilename == \"${MODEL_NAME}\") | .sha256")
```

### 2. 모델 다운로드

기존처럼 wget으로 파일을 내려받는다.

```bash
wget "${MODEL_URL}" -O "${MODEL_PATH}"
```

### 3. 다운로드된 파일 검증

sha256sum을 이용해 실제 다운로드된 파일의 해시를 계산하고, API에서 가져온 값과 비교한다.
만약 일치하지 않으면 즉시 삭제하고 오류를 출력한다.

```bash
actual_hash=$(sha256sum "${MODEL_PATH}" | awk '{print $1}')
if [[ "${actual_hash}" != "${EXPECTED_SHA256}" ]]; then
  echo "Checksum mismatch"
  rm -f "${MODEL_PATH}"
exit 1
fi
```

## 코드 변화의 의미

결국 이 기여는 단순한 스크립트 수정에 불과할 수도 있다. 하지만 그 효과는 작지 않다.

- 안정성 확보: 손상된 모델 파일이 로컬 캐시에 남지 않도록 보장한다.
- 보안 강화: 다운로드 과정에서 악의적인 변조가 발생해도 즉시 탐지 가능하다.
- 사용자 신뢰성 향상: “kubectl-ai는 안전하게 모델을 관리한다”라는 신뢰를 제공한다.

즉, 작은 코드 한 줄이 프로젝트 전반의 신뢰성을 크게 높인 것이다.

## 마무리

이번 경험은 오픈소스 기여란 거창한 기능 추가가 아니라, 작은 부분에서 품질을 개선하는 것일 수 있다는 점을 다시금 깨닫게 했다.
주석 하나를 그냥 지나쳤다면 없었을 변화지만, 개선 의식을 가지고 코드를 읽었기에 기여로 이어질 수 있었다.

앞으로도 나는 이런 작은 불편과 빈틈을 발견하면, 그것을 모두가 함께 쓰는 개선점으로 만들어내고 싶다.

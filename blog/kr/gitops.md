# GitOps 도입기

_by Seunggi Hong_

쿠버네티스 운영에서 CI/CD는 곧 서비스의 심장이다. 한동안 우리는 **Jenkins + ArgoCD** 조합을 썼다. 그런데 **설계자가 아무 설명서 없이 퇴사**하면서 문제가 시작됐다.
남겨진 Jenkins 잡은 블랙박스가 되었고, 작은 변경도 큰 리스크로 느껴졌다. “이대로는 유지보수 불가”라는 결론에 도달했고, **저장소 GitLab→GitHub 이전**과 함께 CI/CD를 전면 재구축하기로 했다.

그 과정에서 여러 도구를 **스코어링 방식으로 비교**했다. 단순한 취향이 아니라, 수치화된 근거로 결정을 내리고 싶었다.

## 배경: 왜 갈아탔나

- **지식 단절**: 설계 의도·운영 가이드 부재 → 유지보수 불가 상태.
- **운영 비용**: Jenkins 서버/플러그인/보안 패치 관리 부담.
- **전략 전환**: 코드와 파이프라인을 한데 묶는 **GitHub 중심 운영** + **GitOps** 강화를 목표로.

## 사전 검토: CI 툴 스코어링 요약

| CI 툴              |       총점 | 한 줄 결론                                                   |
| ------------------ | ---------: | ------------------------------------------------------------ |
| **GitHub Actions** | **96/100** | 개발자 경험·생태계·유연성 압도적. GitHub 중심 협업에 최적.   |
| **Drone CI**       |     76/100 | 가볍고 빠르나 수동 설정·생태계·고급 기능이 발목.             |
| **Jenkins X**      |     72/100 | K8s 네이티브/깊은 GitOps 지향, 그러나 도입·유지 난이도 높음. |

**왜 GitHub Actions가 1위였나?**

- `.github/workflows`에 **YAML 추가만으로 즉시 구동**, 러너 선택(Hosted/Self-hosted) 용이.
- **마켓플레이스 액션**과 **조건/매트릭스/재사용 워크플로**로 복잡한 파이프라인 구성에 유리.
- **조직/리포/환경 단위 시크릿**과 **승인 정책(Environments/RBAC)** 등 거버넌스 기능 충실.
- Jenkins 대비 **서버/플러그인 관리 부담 0**.

> 결론: **“유지보수 불가 상태를 빠르게 정상화해야 하는”** 우리 상황에서 가장 리스크가 낮고, 장기 운영성도 좋은 선택이었다.

## 사전 검토: CD 툴 스코어링 요약

| CD 툴                           |       총점 | 한 줄 결론                                                                       |
| ------------------------------- | ---------: | -------------------------------------------------------------------------------- |
| **ArgoCD**                      | **97/100** | GitOps 정석. Pull 기반 동기화·드리프트 감지·원클릭 롤백·멀티클러스터 강력.       |
| **GitHub Actions(CD로만 활용)** | **70/100** | 트리거·UX는 우수하나 상태 동기화/자동 롤백/드리프트 감지 부재. GitOps 대체 불가. |

**왜 ArgoCD가 필수였나?**

- “**Git에 선언된 상태** = **클러스터의 실제 상태**”를 보장하는 **Pull 기반 컨트롤러**.
- **드리프트 감지/자동 복구, 커밋 기준 롤백**, 멀티클러스터/멀티테넌시 지원.
- Actions만으로도 배포는 가능하지만, **GitOps의 핵심(상태·동기화·롤백)** 을 채우기 어렵다.

> 결론: **CI는 GitHub Actions, CD는 ArgoCD**가 역할 분담이 명확하고, 우리 요구(안정성/확장성)에 가장 부합.

## 평가 지표 상세

### Drone CI

<details>
<summary>📍 Drone CI 종합 평가 요약 (총점: 76/100)</summary>

경량화된 오픈소스 CI 도구로, 컨테이너 기반 아키텍처와 클라우드 환경에서 유리한 성능을 보임.  
하지만 수동 설정 요소가 많고, 플러그인 생태계 및 고급 기능 활용에 한계가 있음.

**항목별 평가**

1. 설정 및 도입 편의성 - 5
2. 워크플로우 구성 유연성 - 6
3. Runner 관리 및 확장성 - 9
4. 컨테이너/클라우드 네이티브 지원 - 10
5. 플러그인/생태계 확장성 - 7
6. Git 연동 및 이벤트 트리거 - 8
7. 속도/성능 최적화 - 8
8. 보안 및 시크릿 관리 - 10
9. 모니터링 및 피드백 UX - 8
10. 유지 보수성 - 5

😎 **분석**: 클라우드 네이티브 DevOps 경험이 있는 팀에는 적합. 하지만 UI/UX, 자동화 편의성이 중요한 경우 GitHub Actions가 더 나음.

</details>

### GitHub Actions (CI)

<details>
<summary>📍 GitHub Actions 종합 평가 요약 (총점: 96/100)</summary>

CI/CD 대표 SaaS 기반 도구. GitHub 생태계와 깊게 통합되어 개발자 경험과 자동화 유연성이 매우 뛰어남.

**항목별 평가**

1. 설정 및 도입 편의성 - 10
2. 워크플로우 구성 유연성 - 10
3. Runner 관리 및 확장성 - 10
4. 컨테이너/클라우드 네이티브 지원 - 9
5. 플러그인/생태계 확장성 - 10
6. Git 연동 및 이벤트 트리거 - 10
7. 속도/성능 최적화 - 8
8. 보안 및 시크릿 관리 - 10
9. 모니터링 및 피드백 UX - 10
10. 유지 보수성 - 9

😎 **분석**: GitHub 기반 협업에는 최적. 빠른 도입, 확장성, AI(Copilot) 통합까지 지원해 현대형 CI/CD 플랫폼으로 손꼽힘.

</details>

### Jenkins X

<details>
<summary>📍 Jenkins X 종합 평가 요약 (총점: 72/100)</summary>

Kubernetes 기반 GitOps 중심 CI/CD 도구. 강력한 자동화와 K8s 통합 기능을 제공하지만 도입/운영 난이도가 높음.

**항목별 평가**

1. 설정 및 도입 편의성 - 4
2. 워크플로우 구성 유연성 - 6
3. Runner 관리 및 확장성 - 9
4. 컨테이너/클라우드 네이티브 지원 - 10
5. 플러그인/생태계 확장성 - 8
6. Git 연동 및 이벤트 트리거 - 9
7. 속도/성능 최적화 - 8
8. 보안 및 시크릿 관리 - 8
9. 모니터링 및 피드백 UX - 6
10. 유지 보수성 - 4

😎 **분석**: 대규모 조직의 플랫폼 팀이나 고도화된 DevOps 조직에는 적합. 하지만 스타트업·소규모 팀엔 부담이 큼.

</details>

### GitHub Actions (CD)

<details>
<summary>📍 GitHub Actions CD 평가 (총점: 70/100)</summary>

CI/CD 통합 관리에는 강점이 있으나 GitOps 관점에서는 한계가 있음. 상태 동기화, 자동 롤백, 멀티클러스터 지원 부족.

**항목별 평가**

- 배포 트리거 방식 - 8
- GitOps 모델 적합성 - 8
- Kubernetes 통합 수준 - 7
- 롤백 기능 - 4
- 상태 감지 및 자동 동기화 - 3
- CI/CD 파이프라인 통합 유연성 - 10
- 보안 및 시크릿 관리 - 7
- 접근 제어 및 RBAC - 10
- 모니터링 및 피드백 UX - 10
- 확장성 및 멀티클러스터 지원 - 3

😎 **분석**: 단일 클러스터·소규모 팀엔 적합. 하지만 GitOps 핵심 기능 부족 → ArgoCD 같은 보완 도구 필요.

</details>

### ArgoCD

<details>
<summary>📍 ArgoCD 종합 평가 요약 (총점: 97/100)</summary>

GitOps 원칙을 가장 충실하게 구현한 Kubernetes 네이티브 CD 도구. Pull 기반 동기화, 드리프트 감지, 롤백, 멀티클러스터까지 지원.

**항목별 평가**

- 배포 트리거 방식 - 10
- GitOps 모델 적합성 - 10
- Kubernetes 통합 수준 - 10
- 롤백 기능 - 10
- 상태 감지 및 자동 동기화 - 10
- CI/CD 파이프라인 통합 유연성 - 7
- 보안 및 시크릿 관리 - 10
- 접근 제어 및 RBAC - 10
- 모니터링 및 피드백 UX - 10
- 확장성 및 멀티클러스터 지원 - 10

😎 **분석**: 기업 환경의 GitOps CD 최적 솔루션. 안정성·확장성·보안성 모두 충족.

</details>

## 최종 결정: GitHub Actions + ArgoCD

**선택 기준**

1. **단절 복구 속도**: 빠르게 안정화 가능해야 함.
2. **운영 단순화**: 관리 포인트 최소화(서버/플러그인/보안패치 Zero 지향).
3. **GitOps 적합성**: 선언형·감시·롤백·멀티클러스터 필수.
4. **확장성**: 프라이빗 레지스트리(Harbor), 환경 분리, 승인 절차, 알림 연계까지.

**아키텍처 요약**

- **CI(GitHub Actions)**: 테스트 → Docker 빌드 → **Harbor 푸시** → **배포용 manifest 이미지 태그 자동 업데이트 커밋**
- **CD(ArgoCD)**: Git 변경을 감지해 **자동/수동 동기화**, 환경에 따라 정책 차등 적용

  - Dev: auto-sync / Stage: auto 또는 manual / Prod: manual(승인 필수)

## 마이그레이션 & 구성 핵심

### 저장소 이전

- `git clone --mirror`로 **브랜치/태그/커밋 이력** 보존 → GitHub로 Push
- 무결성 검증 후 리드미·브랜치 전략 정리

### CI 워크플로(예시)

- `.github/workflows/ci.yml`: Lint/테스트
- `.github/workflows/docker-publish.yml`: Docker 빌드 → **Harbor 푸시**
- `.github/workflows/update-tag.yml`: `manifest repo` kustomization 이미지 태그 업데이트 커밋

**시크릿/변수 예시**

- `HARBOR_USER`, `HARBOR_PASSWORD`, `REGISTRY`(예: `infra.harbor.com`)
- GitHub **Environments**로 배포 승인·시크릿 범위·보호 규칙 분리

### CD 구조(예시)

```bash
.
├── base
│   ├── deployment.yaml
│   ├── kustomization.yaml
│   └── service.yaml
├── overlays
│   ├── dev
│   │   ├── ingress.yaml
│   │   ├── kustomization.yaml
│   │   └── node-selector-patch.yaml
│   ├── prod
│   │   ├── ingress.yaml
│   │   ├── kustomization.yaml
│   │   └── node-selector-patch.yaml
│   └── stg
│       ├── ingress.yaml
│       ├── kustomization.yaml
│       └── node-selector-patch.yaml
```

- Actions가 새 태그로 **manifest 커밋** → ArgoCD가 감지/적용
- Prod는 **manual-sync**로 운영자 승인 필수

## 전환 효과

- **투명성**: “누가/언제/무엇을” 변경했는지가 **커밋+Actions 로그**로 끝.
- **운영 부담 축소**: Jenkins 관리 포인트 제거, GitHub 중심으로 단순화.
- **안정성/복구력**: ArgoCD의 **드리프트 감지/원클릭 롤백**으로 장애 대응 시간 단축.
- **확장성**: 멀티클러스터·환경별 승인·프리뷰 배포·Canary/Rollout로 확장 용이.

## 교훈

> **문서 없는 자동화는 기술 부채다.**
> 유지보수 가능한 설계·문서·권한/비밀 관리·승인 절차가 함께 설계되어야 한다.

이번 재구축은 단순한 도구 교체가 아니라, **Git을 단일 진실 소스로 삼는 GitOps 문화 전환**이었다.
그리고 “빠르게 정상화”해야 했던 현실적 제약 속에서, **GitHub Actions + ArgoCD** 조합은 가장 작은 리스크로 가장 큰 안정성을 확보하는 선택이었다.
